


# Patch Software Script (Legacy)

> ⚠️ **Deprecated**: This script is maintained for backward compatibility only.
> **Recommendation**: Use [`update-third-party-with-winget.ps1`](./update-third-party-with-winget.md) for new implementations.

## Overview

This PowerShell script automates the process of updating third-party software installed on a Windows computer using `winget`. It logs all update actions and handles errors gracefully. This script is intended for environments where keeping software up to date is critical.

### Key Differences from Recommended Script

- Simpler implementation
- Hardcoded log location: `C:\\tools\\patching\\logs\\`
- No JSON configuration support
- No filtering or scoping options

## Requirements

1. **PowerShell**: This script requires PowerShell, which comes pre-installed on most modern Windows systems.
2. **Winget**: Ensure the Windows Package Manager (`winget`) is installed. The script assumes that `winget` is installed under a specific directory based on the version number.
3. **Administrator Privileges**: This script needs to be run with administrator privileges to update system software.
4. **Execution Policy**: The script temporarily bypasses the PowerShell execution policy to run without restrictions.

## Features

- Automatically updates all installed software that has available updates.
- Handles both known and unknown packages.
- Silent updates without user interaction.
- Comprehensive logging to a specified log file.
- Error handling for missing files and failed updates.
  
## Script Details

- The script uses `winget.exe` from the system PATH for maximum compatibility with any installed version.
- Updates all applications with available updates.
- Logs all actions to a timestamped log file located in the directory `C:\tools\patching\logs\`.
- Ensures that the log directory exists and creates it if necessary.
- Uses `Start-Transcript` to capture a complete log of the script's execution.

## How to Use

### 1. Setup

- **Winget Installation**: Ensure that `winget` is installed on your system. You can get it from the [Microsoft Store](https://aka.ms/getwinget).
- **Script Setup**: Save the PowerShell script to a desired location on your machine. [patch-software-windows.ps1](./patch-software-windows.ps1)

### 2. Running the Script

1. Open PowerShell **as Administrator**.
2. Run the script using the following example command:

   ```powershell
    powershell -NoProfile -ExecutionPolicy Bypass -File "C:\tools\patching\patch_software_windows.ps1"
   ```

### 3. Script Parameters

- **$wingetversion**: This variable should be updated to reflect the current installed version of `winget`. It is used to construct the path to the `winget.exe` file.
- **$logPath**: Directory where the log files are stored.
- **$logFilename**: The filename for the log file, which includes the current date for easy tracking.

### 4. Log File Location

The log files generated by this script will be saved in the `C:\tools\patching\logs\` directory. Each log file is named `winget-YYYY-MM-DD.log` (based on the date the script is run).

### 5. Error Handling

- If the specified `winget.exe` version is not found, the script will log an error and exit.
- If there are any errors during the upgrade process, the script will catch and log the exception, allowing for troubleshooting.

### 6. Scheduling the Script

To ensure the script runs regularly (e.g., daily or weekly), you can schedule it using **Windows Task Scheduler**:

- Open Task Scheduler.
- Create a new task.
- Set the action to start PowerShell with the path to your script.
- Set the task to run with elevated privileges (Run as administrator).

## Notes

- Make sure to update `$wingetversion` to the correct version when `winget` is updated.
- If running this script as a scheduled task, make sure it is set to run with administrative privileges to allow for updates.
- ⚠️ **Migration Notice**: For new deployments, consider using [`update-third-party-with-winget.ps1`](./update-third-party-with-winget.md) which offers:
  - JSON-based configuration
  - Better error handling
  - Filtering and scope management
  - More comprehensive logging
  - Active maintenance and testing

## Troubleshooting

- If `winget.exe` is not found, verify the version number and path. You can check the installed `winget` version by running `winget --version` in a command prompt.
- Check the logs in `C:\tools\patching\logs\` for detailed information about the script's execution and any errors that may have occurred.
